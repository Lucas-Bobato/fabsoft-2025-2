<!DOCTYPE html>
<html>
<head>
    <title>SlamTalk - Boxscore Ao Vivo</title>
</head>
<body>
    <h1>Boxscore Ao Vivo</h1>
    <div>
        <label for="jogoId">ID do Jogo:</label>
        <input type="number" id="jogoId" value="1">
        <button onclick="conectar()">Conectar</button>
        <button onclick="desconectar()" disabled id="disconnectBtn">Desconectar</button>
    </div>
    <hr>
    <h2>Placar Atual</h2>
    <pre id="placar"></pre>
    <h2>Log de Mensagens</h2>
    <ul id="messages"></ul>

    <script>
        let ws;
        const jogoIdInput = document.getElementById("jogoId");
        const connectBtn = document.querySelector("button[onclick='conectar()']");
        const disconnectBtn = document.getElementById("disconnectBtn");
        const placarDiv = document.getElementById("placar");
        const messagesList = document.getElementById("messages");

        function conectar() {
            const jogoId = jogoIdInput.value;
            if (!jogoId) {
                alert("Por favor, insira um ID de jogo.");
                return;
            }
            // O URL do WebSocket come√ßa com 'ws://' em vez de 'http://'
            ws = new WebSocket(`ws://localhost:8000/jogos/ws/jogos/${jogoId}`);
            
            ws.onopen = function(event) {
                const li = document.createElement('li');
                li.textContent = `Conectado ao jogo ${jogoId}!`;
                messagesList.appendChild(li);
                connectBtn.disabled = true;
                disconnectBtn.disabled = false;
            };

            ws.onmessage = function(event) {
                const data = JSON.parse(event.data);
                
                // Atualiza o placar
                placarDiv.textContent = JSON.stringify(data, null, 2);

                // Adiciona a mensagem ao log
                const li = document.createElement('li');
                li.textContent = `Update recebido: ${event.data}`;
                messagesList.appendChild(li);
            };

            ws.onclose = function(event) {
                const li = document.createElement('li');
                li.textContent = "Desconectado.";
                messagesList.appendChild(li);
                connectBtn.disabled = false;
                disconnectBtn.disabled = true;
            };

            ws.onerror = function(event) {
                const li = document.createElement('li');
                li.textContent = `Erro: ${event}`;
                messagesList.appendChild(li);
            };
        }

        function desconectar() {
            if (ws) {
                ws.close();
            }
        }
    </script>
</body>
</html>